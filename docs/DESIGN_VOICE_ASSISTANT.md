# PhotoNest - 설계서: 음성 비서 시스템 (Nesty)

> "야 네스티, 지난 여름 가족사진 보여줘" → TV/태블릿에서 바로 실행

---

## 1. 개요

### 1.1 컨셉

PhotoNest 서버에 **알렉사 스타일의 음성 비서** "Nesty"를 탑재하여,
음성 대화로 사진을 검색하고, 슬라이드쇼를 실행하고, 시스템을 제어한다.

### 1.2 두 가지 동작 모드

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│  모드 A: 다이렉트 모드 (태블릿 서버)                              │
│  ─────────────────────────────────────                          │
│  태블릿 자체 마이크로 음성 인식                                   │
│                                                                 │
│  사용자 → "야 네스티" → 🎙️ 태블릿 마이크 → STT → 명령 실행       │
│                         ↕                                       │
│                    태블릿 화면에 대화 표시                         │
│                    태블릿 스피커로 TTS 응답                       │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  모드 B: 리모트 모드 (폰앱 → 서버)                               │
│  ─────────────────────────────────                              │
│  서버에 마이크가 없을 때, 폰앱을 마이크로 활용                     │
│                                                                 │
│  사용자 → 🎙️ 폰앱 음성버튼 → STT → WebSocket → 서버 명령 실행   │
│                                                      ↕          │
│                              서버 화면에 대화 결과 표시            │
│                              폰앱에도 결과 표시 + TTS             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 1.3 비서 이름 설정

| 항목 | 내용 |
|------|------|
| 기본 이름 | "네스티" (Nesty) |
| 커스텀 호출명 | 사용자가 설정에서 변경 가능 |
| 호출 예시 | "야 네스티", "네스티야", "헤이 네스티" |
| 기술 | OpenWakeWord (커스텀 모델 학습) |

---

## 2. 시스템 아키텍처

### 2.1 전체 구조

```
┌─────────────────── PhotoNest Server (태블릿/셋탑) ───────────────────┐
│                                                                      │
│  ┌──────────────┐   ┌──────────────┐   ┌───────────────────────┐    │
│  │  Wake Word   │   │    STT       │   │    NLU (명령 해석)     │    │
│  │  Detection   │──►│  Engine      │──►│                       │    │
│  │              │   │              │   │  의도 분류 + 슬롯 추출  │    │
│  │ OpenWakeWord │   │ Vosk/Whisper │   │  (Regex → Snips NLU)  │    │
│  └──────┬───────┘   └──────────────┘   └───────────┬───────────┘    │
│         │                                           │                │
│         │  마이크 입력                                ▼                │
│  ┌──────┴───────┐                      ┌───────────────────────┐    │
│  │  Audio       │                      │   Command Executor    │    │
│  │  Manager     │                      │                       │    │
│  │              │                      │  사진 검색 / 슬라이드쇼 │    │
│  │ Termux:API   │                      │  앨범 조회 / 시스템    │    │
│  │ microphone   │                      └───────────┬───────────┘    │
│  └──────────────┘                                  │                │
│                                                    ▼                │
│  ┌──────────────┐                      ┌───────────────────────┐    │
│  │  TTS Engine  │◄─────────────────────│   Response Builder    │    │
│  │              │                      │                       │    │
│  │ Android TTS  │                      │  자연어 응답 생성      │    │
│  │ (termux-api) │                      └───────────────────────┘    │
│  └──────────────┘                                                   │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                   Server Display UI                          │   │
│  │  (Android 앱 / Flutter TV 앱 / 웹 대시보드)                   │   │
│  │                                                              │   │
│  │  대화 상태 표시 + 결과 표시 + 사진/슬라이드쇼 출력             │   │
│  └──────────────────────────────────────────────────────────────┘   │
│                              ▲                                      │
│                              │ WebSocket                            │
└──────────────────────────────┼──────────────────────────────────────┘
                               │
                    ┌──────────┴──────────┐
                    │  Flutter App (폰)    │
                    │                     │
                    │  🎙️ 음성 명령 모드   │
                    │  텍스트 입력도 가능   │
                    │  결과 동시 표시      │
                    └─────────────────────┘
```

### 2.2 기술 스택

| 구성요소 | 기술 | 비고 |
|---------|------|------|
| Wake Word | OpenWakeWord | 오픈소스, Termux 호환 확인됨 |
| STT (1차) | Vosk | 경량 50MB, 오프라인, 한국어 지원 |
| STT (2차) | whisper.cpp (tiny 모델) | 더 높은 정확도 필요 시 |
| STT (폴백) | Google Cloud STT | 온라인, 월 60분 무료 |
| NLU | Regex 패턴 매칭 → Snips NLU | 단순 → 점진 확장 |
| TTS | Android Native TTS (termux-api) | 한국어 음성 합성 |
| 통신 | WebSocket (FastAPI) | 실시간 양방향 |
| 오디오 입력 | termux-microphone-record / Flutter | 다이렉트/리모트 모드 |

---

## 3. 모드 A: 다이렉트 모드 (태블릿 서버)

### 3.1 동작 시퀀스

```
시간 ──────────────────────────────────────────────────────────►

[상시 대기]          [호출 감지]        [음성 인식]         [명령 실행]
    │                    │                 │                  │
    ▼                    ▼                 ▼                  ▼

┌─────────┐      ┌───────────┐     ┌───────────┐     ┌───────────┐
│ 🔇      │      │ 🎙️        │     │ 🎙️💬      │     │ ✅        │
│ 대기 중  │ ──►  │ 듣는 중... │ ──► │ 인식 중... │ ──► │ 실행 완료  │
│         │      │           │     │           │     │           │
│(화면꺼짐 │      │ "야 네스티" │     │ "지난여름  │     │ 사진 표시  │
│ 또는     │      │  감지!     │     │  사진 보여 │     │ + 음성응답 │
│ 스크린   │      │           │     │  줘"      │     │           │
│ 세이버)  │      │ 화면에     │     │           │     │           │
│         │      │ 파형 표시  │     │ 텍스트    │     │           │
└─────────┘      └───────────┘     │ 표시      │     └───────────┘
                                   └───────────┘
                        │                │               │
                     2~3초 이내       3~5초 이내       즉시
```

### 3.2 서버 화면 상태별 UI

#### 상태 1: 대기 모드 (Idle)

```
┌──────────────────────────────────────────┐
│                                          │
│                                          │
│          ┌────────────────┐              │
│          │                │              │
│          │  📷  PhotoNest │              │
│          │                │              │
│          │  15,234장      │              │
│          │  2026.02.10    │              │
│          │                │              │
│          └────────────────┘              │
│                                          │
│       "야 네스티" 라고 불러보세요          │
│                                          │
└──────────────────────────────────────────┘

* 스크린세이버처럼 사진 슬라이드 또는 시계/정보 표시
* Wake Word 감지 엔진은 백그라운드에서 상시 실행
```

#### 상태 2: 호출 감지 → 듣는 중 (Listening)

```
┌──────────────────────────────────────────┐
│                                          │
│                                          │
│                                          │
│              ┌──────────┐                │
│              │          │                │
│              │  ◉ ◉ ◉   │  ← 음성 파형   │
│              │  ╱╲╱╲╱╲  │    애니메이션   │
│              │          │                │
│              └──────────┘                │
│                                          │
│           🎙️  듣고 있어요...              │
│                                          │
│                                          │
└──────────────────────────────────────────┘

* 화면 전체가 어두운 배경 + 중앙에 음성 파형 애니메이션
* 알렉사의 파란 링처럼 시각적 피드백
* 5초간 음성 입력 없으면 → 대기 모드로 복귀
```

#### 상태 3: 인식 완료 → 처리 중 (Processing)

```
┌──────────────────────────────────────────┐
│                                          │
│  🗣️ "지난 여름 가족사진 보여줘"            │
│                                          │
│              ┌──────────┐                │
│              │  ◉ · ·   │                │
│              │  처리 중   │  ← 로딩 표시   │
│              └──────────┘                │
│                                          │
│                                          │
└──────────────────────────────────────────┘

* 상단에 인식된 텍스트 표시 (사용자가 확인 가능)
* 중앙에 처리 중 애니메이션
```

#### 상태 4: 응답 + 결과 표시 (Result)

```
┌──────────────────────────────────────────┐
│                                          │
│  🗣️ "지난 여름 가족사진 보여줘"            │
│  🤖 "2025년 여름 사진 48장을 찾았어요.     │
│      슬라이드쇼로 보여드릴게요!"            │
│                                          │
│  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐    │
│  │    │ │    │ │    │ │    │ │    │    │
│  │ 📷 │ │ 📷 │ │ 📷 │ │ 📷 │ │ 📷 │    │
│  │    │ │    │ │    │ │    │ │    │    │
│  └────┘ └────┘ └────┘ └────┘ └────┘    │
│  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐    │
│  │ 📷 │ │ 📷 │ │ 📷 │ │ 📷 │ │ 📷 │    │
│  └────┘ └────┘ └────┘ └────┘ └────┘    │
│                                          │
│  "다음", "슬라이드쇼", "그만" 이라고       │
│   말해보세요                              │
│                                          │
└──────────────────────────────────────────┘

* 대화 내역이 상단에 채팅 형태로 표시
* 결과(사진, 앨범 등)가 중앙에 표시
* 하단에 후속 명령 가이드 표시
* TTS로 응답 내용 음성 출력
```

#### 상태 5: 에러 / 인식 실패

```
┌──────────────────────────────────────────┐
│                                          │
│  🗣️ "ㅁㅁㅁ... (인식 불가)"               │
│                                          │
│              ┌──────────┐                │
│              │  😕      │                │
│              │ 잘 못     │                │
│              │ 알아들었어요│                │
│              └──────────┘                │
│                                          │
│       다시 말씀해 주시겠어요?              │
│                                          │
└──────────────────────────────────────────┘

* 3초 후 자동으로 듣기 모드 재진입
* 2회 연속 실패 시 대기 모드로 복귀
```

---

## 4. 모드 B: 리모트 모드 (폰앱 → 서버)

### 4.1 동작 시퀀스

```
[폰 앱]                          [서버]

1. 🎙️ 버튼 길게 누르기
   (또는 "음성 명령" 탭)
         │
         ▼
2. 폰에서 음성 녹음 시작
   STT 실시간 처리
   (speech_to_text 패키지)
         │
         ▼
3. 인식된 텍스트를
   WebSocket으로 전송 ──────────► 4. 서버: 명령 수신
                                     NLU 분석
                                     명령 실행
                                        │
                                        ▼
5. 폰 앱에 결과 표시  ◄─────────── 6. 서버: 결과 응답
   + TTS 음성 재생                      서버 화면에도
                                        대화 내용 표시
```

### 4.2 폰 앱 - 음성 명령 UI

#### 음성 버튼 (항상 접근 가능)

```
기존 하단 탭 바에 음성 버튼 통합:

┌───────────────────────────────────────────┐
│                                           │
│   📷        🔍         📁       👨‍👩‍👧‍👦       📺 │
│  사진      검색       앨범     가족      TV  │
│                                           │
│              ┌─────┐                      │
│              │ 🎙️  │  ← 플로팅 음성 버튼   │
│              └─────┘     (길게 누르면 활성) │
└───────────────────────────────────────────┘
```

#### 음성 명령 활성 상태

```
┌───────────────────────────────────────────┐
│                                           │
│  [←]   음성 명령                    [⋯]   │
│                                           │
│  ┌─ 대화 내역 ───────────────────────┐    │
│  │                                   │    │
│  │  🗣️ 나: "엄마 사진 보여줘"        │    │
│  │                                   │    │
│  │  🤖 네스티: "엄마가 태그된 사진     │    │
│  │     1,234장을 찾았어요!"           │    │
│  │                                   │    │
│  │  ┌────┐ ┌────┐ ┌────┐            │    │
│  │  │ 📷 │ │ 📷 │ │ 📷 │   → 더보기  │    │
│  │  └────┘ └────┘ └────┘            │    │
│  │                                   │    │
│  │  🗣️ 나: "그중에 제주도 사진만"     │    │
│  │                                   │    │
│  │  🤖 네스티: "제주도에서 찍은        │    │
│  │     엄마 사진 87장이에요!"         │    │
│  │                                   │    │
│  └───────────────────────────────────┘    │
│                                           │
│  ┌───────────────────────────────────┐    │
│  │  💬 텍스트로 입력...        [🎙️]  │    │
│  └───────────────────────────────────┘    │
│                                           │
│       🎙️ 길게 눌러서 말하기               │
│       (또는 텍스트 입력)                   │
│                                           │
└───────────────────────────────────────────┘

기능:
  - Push-to-Talk: 🎙️ 버튼 길게 누르는 동안 녹음
  - 텍스트 입력: 키보드로 명령어 직접 입력도 가능
  - 대화 내역: 채팅 형태로 대화 히스토리 표시
  - 결과 인라인 표시: 사진 썸네일 등 결과를 대화 안에 표시
  - 서버 화면 미러: 서버 화면에도 동일 대화 내용 표시
```

### 4.3 서버 화면 - 리모트 모드 표시

```
┌──────────────────────────────────────────┐
│                                          │
│  📱 엄마 iPhone에서 음성 명령 수신 중      │
│                                          │
│  ┌─ 대화 내역 ────────────────────────┐  │
│  │                                    │  │
│  │  🗣️ 엄마: "아기 사진 슬라이드쇼     │  │
│  │          틀어줘"                    │  │
│  │                                    │  │
│  │  🤖 네스티: "아기 태그된 사진        │  │
│  │     234장으로 슬라이드쇼를           │  │
│  │     시작할게요!"                    │  │
│  │                                    │  │
│  └────────────────────────────────────┘  │
│                                          │
│  ┌────────────────────────────────────┐  │
│  │                                    │  │
│  │         🖼️ 슬라이드쇼 실행 중       │  │
│  │                                    │  │
│  │         [현재 사진 표시]             │  │
│  │                                    │  │
│  └────────────────────────────────────┘  │
│                                          │
│  📱 음성 명령으로 "다음", "정지" 가능     │
│                                          │
└──────────────────────────────────────────┘

* 어느 기기에서 명령했는지 표시 (이름 + 아이콘)
* 대화 내역이 서버 화면에 실시간 동기화
* 명령 결과(슬라이드쇼, 사진 등)가 서버 화면에 표시
```

---

## 5. 음성 명령어 정의

### 5.1 인텐트 분류표

| 인텐트 (Intent) | 설명 | 예시 발화 |
|-----------------|------|----------|
| `SHOW_PHOTOS` | 조건에 맞는 사진 표시 | "지난 여름 사진 보여줘", "엄마 사진" |
| `PLAY_SLIDESHOW` | 슬라이드쇼 시작 | "슬라이드쇼 틀어줘", "사진 재생" |
| `CONTROL_SLIDESHOW` | 슬라이드쇼 제어 | "다음", "이전", "정지", "계속" |
| `SEARCH_PERSON` | 인물 검색 | "아빠 나오는 사진", "가족 사진" |
| `SEARCH_PLACE` | 장소 검색 | "제주도 사진", "바다 사진" |
| `SEARCH_DATE` | 날짜 검색 | "작년 크리스마스", "2024년 여름" |
| `SHOW_ALBUM` | 앨범 열기 | "가족여행 앨범 열어줘" |
| `SHOW_MEMORIES` | 추억 보기 | "오늘의 추억", "3년 전 사진" |
| `SYSTEM_STATUS` | 시스템 상태 | "저장 공간 얼마나 남았어?" |
| `STOP` | 중지/종료 | "그만", "닫아줘", "종료" |
| `HELP` | 도움말 | "뭐라고 말하면 돼?", "도와줘" |

### 5.2 슬롯 (Slot) 정의

| 슬롯 | 타입 | 예시 값 |
|------|------|--------|
| `person` | 인물 이름 | "엄마", "아빠", "동생" |
| `place` | 장소명 | "제주도", "서울", "바다" |
| `date_range` | 날짜 범위 | "지난 여름", "2024년", "어제" |
| `album_name` | 앨범 이름 | "가족여행", "아기성장" |
| `count` | 숫자 | "10장", "최근 5개" |
| `action` | 제어 동작 | "다음", "이전", "정지" |

### 5.3 명령어 파싱 예시

```
발화: "지난 여름 엄마랑 제주도 간 사진 보여줘"

파싱 결과:
{
  "intent": "SHOW_PHOTOS",
  "slots": {
    "date_range": {"value": "2025-06~2025-08", "raw": "지난 여름"},
    "person": {"value": "엄마", "raw": "엄마"},
    "place": {"value": "제주도", "raw": "제주도"}
  },
  "confidence": 0.92
}

실행:
  → DB 쿼리: photos WHERE date BETWEEN '2025-06' AND '2025-08'
                    AND faces CONTAINS '엄마'
                    AND location LIKE '%제주%'
  → 결과: 35장 찾음
  → 응답: "지난 여름 제주도에서 엄마와 찍은 사진 35장을 찾았어요!"
```

### 5.4 대화 흐름 (Multi-turn)

```
사용자: "가족 사진 보여줘"
네스티: "가족 사진 2,345장을 찾았어요. 기간을 좁혀볼까요?"

사용자: "올해 것만"                    ← 맥락 유지 (가족 사진)
네스티: "2026년 가족 사진 89장이에요. 보여드릴까요?"

사용자: "응, 슬라이드쇼로"             ← 맥락 유지 (2026년 가족)
네스티: "슬라이드쇼를 시작할게요!"

사용자: "더 빠르게"                    ← 맥락 유지 (슬라이드쇼)
네스티: "간격을 3초로 줄였어요."

사용자: "그만"
네스티: "슬라이드쇼를 멈췄어요."
```

**대화 컨텍스트 관리**:
```
{
  "session_id": "sess_abc123",
  "context": {
    "current_filter": {
      "person": ["가족"],
      "date_range": "2026",
      "place": null
    },
    "current_action": "slideshow",
    "current_results": 89,
    "turn_count": 4
  },
  "timeout": 30  // 30초 무응답 → 세션 종료
}
```

---

## 6. API 설계 (WebSocket)

### 6.1 음성 명령 WebSocket 엔드포인트

```
ws://server:8080/api/v1/voice/stream

── 연결 시 인증 ──
{
  "type": "auth",
  "token": "Bearer eyJhbG..."
}

── 클라이언트 → 서버: 음성 데이터 전송 (리모트 모드) ──
{
  "type": "audio_chunk",
  "data": "<base64 encoded PCM audio>",
  "sample_rate": 16000,
  "encoding": "pcm_s16le"
}

── 클라이언트 → 서버: 텍스트 명령 전송 ──
{
  "type": "text_command",
  "text": "지난 여름 가족사진 보여줘",
  "device_name": "엄마 iPhone"
}

── 서버 → 클라이언트: 상태 업데이트 ──
{
  "type": "state_change",
  "state": "listening" | "processing" | "responding" | "idle",
  "transcription": "지난 여름 가족사진...",  // 실시간 인식 텍스트
  "is_final": false
}

── 서버 → 클라이언트: 명령 결과 ──
{
  "type": "command_result",
  "intent": "SHOW_PHOTOS",
  "response_text": "2025년 여름 가족사진 48장을 찾았어요!",
  "tts_text": "2025년 여름 가족사진 48장을 찾았어요!",
  "result_data": {
    "action": "show_grid",
    "photos": [
      {"id": "p_001", "thumbnail_url": "/thumb/p_001.jpg", "date": "2025-07-15"},
      {"id": "p_002", "thumbnail_url": "/thumb/p_002.jpg", "date": "2025-07-15"}
    ],
    "total_count": 48
  },
  "suggestions": ["슬라이드쇼로 보기", "더 보기", "기간 좁히기"]
}

── 서버 → 모든 연결된 클라이언트: 화면 동기화 ──
{
  "type": "display_sync",
  "screen": "conversation",
  "conversation": [
    {"role": "user", "name": "엄마", "text": "가족사진 보여줘", "timestamp": "..."},
    {"role": "assistant", "text": "가족사진 48장을 찾았어요!", "timestamp": "..."}
  ],
  "current_action": {
    "type": "photo_grid",
    "data": { ... }
  }
}
```

### 6.2 REST API (보조)

```
── 음성 설정 ──
GET    /api/v1/voice/settings          → 음성 비서 설정 조회
PATCH  /api/v1/voice/settings          → 설정 변경

요청 예시:
{
  "wake_word": "네스티",
  "language": "ko-KR",
  "tts_voice": "ko-KR-Standard-A",
  "tts_speed": 1.0,
  "listening_timeout": 5,
  "session_timeout": 30,
  "direct_mode_enabled": true    // 다이렉트 모드 ON/OFF
}

── 대화 히스토리 ──
GET    /api/v1/voice/history           → 최근 대화 내역
DELETE /api/v1/voice/history           → 대화 내역 삭제
```

---

## 7. 음성 처리 파이프라인 상세

### 7.1 다이렉트 모드 파이프라인

```
┌─────────┐    ┌──────────┐    ┌────────┐    ┌──────┐    ┌────────┐
│ 마이크   │───►│OpenWake  │───►│  Vosk  │───►│ NLU  │───►│Executor│
│(상시 청취)│    │Word      │    │  STT   │    │파서  │    │        │
│         │    │          │    │        │    │      │    │        │
│16kHz    │    │"네스티"   │    │텍스트  │    │인텐트│    │DB 쿼리 │
│mono     │    │감지 시    │    │변환    │    │+슬롯 │    │실행    │
│         │    │STT 활성화 │    │        │    │추출  │    │        │
└─────────┘    └──────────┘    └────────┘    └──────┘    └────────┘
                                                              │
                                                              ▼
┌─────────┐    ┌──────────┐                          ┌────────────┐
│ 스피커   │◄───│Android   │◄─────────────────────────│ Response   │
│         │    │TTS       │                          │ Builder    │
│음성 응답 │    │          │                          │            │
└─────────┘    └──────────┘                          └────────────┘
```

### 7.2 리모트 모드 파이프라인

```
┌──── 폰 앱 ────────────┐        ┌──── 서버 ──────────────────┐
│                        │        │                            │
│  마이크 → speech_to_   │  WS    │  텍스트 → NLU → Executor   │
│           text 패키지  │───────►│              │             │
│                        │        │              ▼             │
│  결과 표시 ← ──────────│◄───────│  Response Builder          │
│  + TTS                 │  WS    │      │                    │
│                        │        │      ▼                    │
└────────────────────────┘        │  서버 화면 업데이트         │
                                  │  + 연결된 모든 기기에       │
                                  │    display_sync 전송       │
                                  └────────────────────────────┘

* 폰에서 STT 처리 후 텍스트만 서버로 전송 (트래픽 절약)
* 서버는 텍스트 명령만 받아서 실행 (음성 처리 부하 없음)
```

---

## 8. 서버 디스플레이 앱 설계

### 8.1 개요

서버(태블릿/셋탑)에서 실행되는 **디스플레이 전용 앱**.
Flutter로 개발하여 태블릿 화면 + TV HDMI 출력 모두 지원.

### 8.2 화면 모드

```
┌── 서버 디스플레이 앱 모드 ──────────────────────────────────────┐
│                                                                │
│  ┌─ 대기 모드 ─┐   ┌─ 대화 모드 ─┐   ┌─ 결과 모드 ──────────┐ │
│  │             │   │             │   │                      │ │
│  │  시계       │   │  음성 파형   │   │  사진 그리드          │ │
│  │  날씨       │──►│  대화 텍스트 │──►│  슬라이드쇼           │ │
│  │  추억 사진  │   │  처리 상태   │   │  앨범 표시            │ │
│  │  저장 현황  │   │             │   │  시스템 정보          │ │
│  │             │◄──│             │◄──│                      │ │
│  └─────────────┘   └─────────────┘   └──────────────────────┘ │
│       │                                                        │
│       │    "야 네스티"        "그만"                             │
│       │    또는 폰 음성명령    또는 30초 타임아웃                 │
│       │                                                        │
│  ┌─ 스크린세이버 ─┐                                             │
│  │               │                                             │
│  │  랜덤 사진     │  ← 5분 무활동 시 진입                       │
│  │  천천히 전환   │                                             │
│  └───────────────┘                                             │
└────────────────────────────────────────────────────────────────┘
```

### 8.3 대기 모드 대시보드 레이아웃

```
┌──────────────────────────────────────────────────────────┐
│                                                          │
│   15:42                              2026.02.10 월요일    │
│                                                          │
│  ┌──── 오늘의 추억 ──────────────────────────────────┐   │
│  │                                                    │   │
│  │  ┌─────────────┐   3년 전 오늘                     │   │
│  │  │             │   "2023 제주도 가족여행"            │   │
│  │  │   📷 사진    │                                   │   │
│  │  │             │   엄마, 아빠, 나, 동생              │   │
│  │  └─────────────┘                                   │   │
│  └────────────────────────────────────────────────────┘   │
│                                                          │
│  ┌── 가족 현황 ──┐  ┌── 저장소 ──┐  ┌── 최근 백업 ──┐   │
│  │ 👤 엄마  🟢   │  │ 💾         │  │ 📷 +12장     │   │
│  │ 👤 아빠  🟢   │  │ ████████░░ │  │    엄마       │   │
│  │ 👤 동생  ⚫   │  │ 78% 사용   │  │    5분 전     │   │
│  └───────────────┘  └────────────┘  └───────────────┘   │
│                                                          │
│            "야 네스티" 라고 불러보세요  🎙️                 │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

---

## 9. 기술 타당성 검토 결과

### 9.1 결과 요약

| 구성요소 | 기술 | 상태 | 비고 |
|---------|------|------|------|
| Wake Word | OpenWakeWord | ✅ 확인됨 | Termux에서 동작 확인, ARM64 호환 |
| STT (로컬) | Vosk | ✅ 확인됨 | 50MB 경량 모델, 한국어 지원, 오프라인 |
| STT (대안) | whisper.cpp | ✅ 확인됨 | tiny 모델, Termux에서 동작 확인 |
| TTS | Android TTS | ✅ 확인됨 | termux-api로 접근, 한국어 지원 |
| NLU | Regex 패턴 | ✅ 확인됨 | 의존성 없음, 즉시 구현 가능 |
| 마이크 접근 | termux-microphone-record | ✅ 확인됨 | Termux:API 필요 |
| 폰 음성입력 | speech_to_text (Flutter) | ✅ 확인됨 | Push-to-Talk 방식 권장 |
| 서버 화면 | Flutter (Android 앱) | ✅ 확인됨 | 태블릿 + TV 출력 모두 지원 |

### 9.2 주요 제약 및 대응

| 제약 | 대응 방안 |
|------|----------|
| 셋탑박스에 마이크 없음 | 리모트 모드(폰앱)로 해결, USB 마이크 옵션 |
| Vosk 한국어 인식 정확도 | whisper.cpp tiny 모델로 폴백, 클라우드 STT 3차 폴백 |
| OpenWakeWord 커스텀 학습 | 기본 모델("hey jarvis" 등) 먼저 사용 → 추후 커스텀 학습 |
| 다이렉트 모드 배터리 소모 | Wake Word 감지만 상시 (저전력), STT는 호출 시만 활성 |
| 멀티턴 대화 복잡도 | 세션 기반 컨텍스트로 단순화, 30초 타임아웃 |

---

## 10. 개발 우선순위

### Phase 1 (MVP) - 리모트 모드 먼저
- [ ] 폰 앱에 음성 명령 버튼 + Push-to-Talk
- [ ] 폰에서 STT → 텍스트를 WebSocket으로 서버 전송
- [ ] 서버: 텍스트 명령 → NLU(Regex) → 사진 검색 실행
- [ ] 서버 화면: 대화 내역 + 결과 표시
- [ ] 기본 명령어 10개 지원

### Phase 2 - 다이렉트 모드
- [ ] OpenWakeWord 설치 + 커스텀 호출명 학습
- [ ] Vosk STT 통합 (한국어)
- [ ] 태블릿 마이크 → Wake Word → STT → 명령 실행 파이프라인
- [ ] Android TTS 응답
- [ ] 서버 디스플레이 앱 (대기/대화/결과 모드)

### Phase 3 - 고도화
- [ ] 멀티턴 대화 컨텍스트 관리
- [ ] 더 많은 명령어 + Snips NLU 전환
- [ ] 음성으로 앨범 생성, 공유 등 쓰기 명령
- [ ] 사용자별 음성 인식 (화자 구분)

---

*문서 버전: 1.0*
*작성일: 2026-02-10*
*프로젝트: PhotoNest*
